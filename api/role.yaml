openapi: 3.0.3
info:
  title: Fiber Boilerplate API - Role & Permission Management
  description: API dokumentasi untuk sistem manajemen role dan permission pada fiber boilerplate
  version: 1.0.0
  contact:
    name: Developer Team
    email: developer@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3000/api/v1
    description: Development server
  - url: https://api.example.com/v1
    description: Production server

paths:
  /role/permissions:
    get:
      tags:
        - Role & Permission
      summary: Mendapatkan daftar resource dan permission yang tersedia
      description: Endpoint untuk mendapatkan daftar resource beserta permission yang dapat diberikan pada role
      operationId: getAvailablePermissions
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Daftar resource dan permission berhasil diambil
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PermissionsResponse'
              example:
                success: true
                message: "Daftar resource dan permission berhasil diambil"
                code: 200
                data:
                  items:
                    - name: "Project"
                      permissions:
                        - action: "upload"
                          label: "Upload project"
                        - action: "update"
                          label: "Perbarui project"
                        - action: "view"
                          label: "Lihat project"
                        - action: "delete"
                          label: "Hapus project"
                    - name: "Modul"
                      permissions:
                        - action: "upload"
                          label: "Upload modul"
                        - action: "update"
                          label: "Perbarui modul"
                        - action: "view"
                          label: "Lihat modul"
                        - action: "delete"
                          label: "Hapus modul"
                    - name: "User"
                      permissions:
                        - action: "create"
                          label: "Buat user"
                        - action: "update"
                          label: "Perbarui user"
                        - action: "view"
                          label: "Lihat user"
                        - action: "delete"
                          label: "Hapus user"
                timestamp: "2024-01-01T10:00:00Z"
        '401':
          description: Token tidak valid atau sudah expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /role:
    get:
      tags:
        - Role & Permission
      summary: Mendapatkan daftar role
      description: Endpoint untuk mendapatkan daftar role dengan dukungan pencarian dan pagination
      operationId: getRoleList
      security:
        - BearerAuth: []
      parameters:
        - name: search
          in: query
          description: Pencarian berdasarkan nama role
          required: false
          schema:
            type: string
            example: "admin"
        - name: page
          in: query
          description: Nomor halaman untuk pagination
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
            example: 1
        - name: limit
          in: query
          description: Jumlah item per halaman
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
            example: 10
      responses:
        '200':
          description: Daftar role berhasil diambil
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleListResponse'
              example:
                success: true
                message: "Daftar role berhasil diambil"
                code: 200
                data:
                  items:
                    - id: 1
                      nama_role: "Admin"
                      jumlah_permission: 12
                      tanggal_diperbarui: "2024-01-01T10:00:00Z"
                    - id: 2
                      nama_role: "Dosen"
                      jumlah_permission: 8
                      tanggal_diperbarui: "2024-01-02T14:30:00Z"
                  pagination:
                    page: 1
                    limit: 10
                    total_items: 5
                    total_pages: 1
                timestamp: "2024-01-01T10:00:00Z"
        '400':
          description: Parameter query tidak valid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
        '401':
          description: Token tidak valid atau sudah expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Tidak memiliki akses"
                code: 401
                timestamp: "2024-01-01T10:00:00Z"
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags:
        - Role & Permission
      summary: Membuat role baru
      description: Endpoint untuk membuat role baru dengan permission
      operationId: createRole
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleCreateRequest'
            example:
              nama_role: "Mahasiswa"
              permissions:
                Project:
                  - "upload"
                  - "view"
                Modul:
                  - "view"
      responses:
        '201':
          description: Role berhasil dibuat
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleCreateResponse'
              example:
                success: true
                message: "Role berhasil dibuat"
                code: 201
                data:
                  id: 3
                  nama_role: "Mahasiswa"
                  permissions:
                    - resource: "Project"
                      actions: ["upload", "view"]
                    - resource: "Modul"
                      actions: ["view"]
                  jumlah_permission: 3
                  created_at: "2024-01-01T10:00:00Z"
                  updated_at: "2024-01-01T10:00:00Z"
                timestamp: "2024-01-01T10:00:00Z"
        '400':
          description: Data validasi tidak valid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
              example:
                success: false
                message: "Data validasi tidak valid"
                code: 400
                errors:
                  - field: "nama_role"
                    message: "Nama role wajib diisi"
                  - field: "permissions"
                    message: "Permissions wajib diisi"
                timestamp: "2024-01-01T10:00:00Z"
        '401':
          description: Token tidak valid atau sudah expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Nama role sudah ada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Nama role sudah ada"
                code: 409
                timestamp: "2024-01-01T10:00:00Z"
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /role/{id}:
    get:
      tags:
        - Role & Permission
      summary: Mendapatkan detail role
      description: Endpoint untuk mendapatkan detail role beserta permission
      operationId: getRoleDetail
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID role yang akan diambil
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Detail role berhasil diambil
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleDetailResponse'
              example:
                success: true
                message: "Detail role berhasil diambil"
                code: 200
                data:
                  id: 1
                  nama_role: "Admin"
                  permissions:
                    - resource: "Project"
                      actions: ["upload", "update", "view", "delete"]
                    - resource: "Modul"
                      actions: ["upload", "update", "view", "delete"]
                    - resource: "User"
                      actions: ["create", "update", "view", "delete"]
                  jumlah_permission: 12
                  created_at: "2024-01-01T10:00:00Z"
                  updated_at: "2024-01-01T10:00:00Z"
                timestamp: "2024-01-01T10:00:00Z"
        '401':
          description: Token tidak valid atau sudah expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Role tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Role tidak ditemukan"
                code: 404
                timestamp: "2024-01-01T10:00:00Z"
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - Role & Permission
      summary: Memperbarui role
      description: Endpoint untuk memperbarui role dan permission
      operationId: updateRole
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID role yang akan diperbarui
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleUpdateRequest'
            example:
              nama_role: "Admin Updated"
              permissions:
                Project:
                  - "upload"
                  - "view"
                  - "delete"
                Modul:
                  - "view"
      responses:
        '200':
          description: Role berhasil diperbarui
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoleUpdateResponse'
              example:
                success: true
                message: "Role berhasil diperbarui"
                code: 200
                data:
                  id: 1
                  nama_role: "Admin Updated"
                  permissions:
                    - resource: "Project"
                      actions: ["upload", "view", "delete"]
                    - resource: "Modul"
                      actions: ["view"]
                  jumlah_permission: 4
                  created_at: "2024-01-01T10:00:00Z"
                  updated_at: "2024-01-02T15:00:00Z"
                timestamp: "2024-01-02T15:00:00Z"
        '400':
          description: Data validasi tidak valid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
        '401':
          description: Token tidak valid atau sudah expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Role tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Nama role sudah ada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Role & Permission
      summary: Menghapus role
      description: Endpoint untuk menghapus role
      operationId: deleteRole
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID role yang akan dihapus
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Role berhasil dihapus
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                success: true
                message: "Role berhasil dihapus"
                code: 200
                timestamp: "2024-01-01T10:00:00Z"
        '401':
          description: Token tidak valid atau sudah expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Role tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Role tidak ditemukan"
                code: 404
                timestamp: "2024-01-01T10:00:00Z"
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    Permission:
      type: object
      properties:
        resource:
          type: string
          example: "Project"
        actions:
          type: array
          items:
            type: string
            enum: [create, upload, update, view, delete]
          example: ["upload", "update", "view", "delete"]

    Role:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        nama_role:
          type: string
          example: "Admin"
        permissions:
          type: array
          items:
            $ref: '#/components/schemas/Permission'
        jumlah_permission:
          type: integer
          example: 12
        created_at:
          type: string
          format: date-time
          example: "2024-01-01T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-01-01T10:00:00Z"

    RoleListItem:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        nama_role:
          type: string
          example: "Admin"
        jumlah_permission:
          type: integer
          example: 12
        tanggal_diperbarui:
          type: string
          format: date-time
          example: "2024-01-01T10:00:00Z"

    Pagination:
      type: object
      properties:
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 10
        total_items:
          type: integer
          example: 5
        total_pages:
          type: integer
          example: 1

    RoleListResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                items:
                  type: array
                  items:
                    $ref: '#/components/schemas/RoleListItem'
                pagination:
                  $ref: '#/components/schemas/Pagination'

    RoleCreateRequest:
      type: object
      required:
        - nama_role
        - permissions
      properties:
        nama_role:
          type: string
          minLength: 2
          maxLength: 50
          example: "Mahasiswa"
        permissions:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
              enum: [create, upload, update, view, delete]
          example:
            Project:
              - "upload"
              - "view"
            Modul:
              - "view"

    RoleCreateResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/Role'

    RoleDetailResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/Role'

    RoleUpdateRequest:
      type: object
      required:
        - nama_role
        - permissions
      properties:
        nama_role:
          type: string
          minLength: 2
          maxLength: 50
          example: "Admin Updated"
        permissions:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
              enum: [create, upload, update, view, delete]
          example:
            Project:
              - "upload"
              - "view"
              - "delete"
            Modul:
              - "view"

    RoleUpdateResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/Role'

    PermissionsResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                items:
                  type: array
                  items:
                    $ref: '#/components/schemas/ResourcePermissions'

    ResourcePermissions:
      type: object
      properties:
        name:
          type: string
          example: "Project"
        permissions:
          type: array
          items:
            $ref: '#/components/schemas/PermissionItem'

    PermissionItem:
      type: object
      properties:
        action:
          type: string
          example: "upload"
        label:
          type: string
          example: "Upload project"

    BaseResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        code:
          type: integer
        timestamp:
          type: string
          format: date-time

    SuccessResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              nullable: true

    ErrorResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            errors:
              type: object
              nullable: true

    ValidationError:
      type: object
      properties:
        field:
          type: string
          example: "nama_role"
        message:
          type: string
          example: "Nama role wajib diisi"

    ValidationErrorResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            errors:
              type: array
              items:
                $ref: '#/components/schemas/ValidationError'

tags:
  - name: Role & Permission
    description: Endpoints untuk manajemen role dan permission