openapi: 3.0.3
info:
  title: Fiber Boilerplate API
  description: |
    API dokumentasi untuk sistem authentication pada fiber boilerplate
    
    **Keamanan Authentication:**
    - Menggunakan algoritma RS256 (RSA 2048-bit) untuk signing token
    - Access token menggunakan JWT dengan expired 1 jam
    - Refresh token disimpan sebagai httpOnly cookie (tidak di response body)
    - Refresh token di-hash sebelum disimpan di database (SHA-256)
    - Token rotation - refresh token berubah setiap kali di-refresh
    - Key rotation support untuk enhanced security
    - CORS dengan domain eksplisit (bukan wildcard)
    - Cookie: httpOnly, secure, sameSite=Strict
  version: 2.0.0
  contact:
    name: Developer Team
    email: developer@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3000/api/v1
    description: Development server
  - url: https://api.example.com/v1
    description: Production server

paths:
  /auth/register/otp:
    post:
      tags:
        - Authentication
      summary: Daftar dengan OTP
      description: |
        Tahap pertama registrasi: kirim nama, email, dan password
        
        **Flow:**
        1. Frontend kirim nama, email, password
        2. Backend validasi, generate OTP 6 digit, kirim via Mailtrap
        3. Frontend tampilkan form input OTP
        4. Lanjut ke /auth/register/verify-otp
        
        **Keamanan:**
        - Password minimal 8 karakter
        - Email harus domain polije.ac.id
        - OTP berlaku 10 menit, max 5 percobaan
      operationId: registerOTP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            example:
              name: "Ilman Nafian"
              email: "E41231969@student.polije.ac.id"
              password: "admin1234"
      responses:
        '200':
          description: OTP berhasil dikirim ke email
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OTPResponse'
              example:
                success: true
                message: "Kode OTP telah dikirim ke email Anda"
                code: 200
                data:
                  message: "Kode OTP telah dikirim ke email Anda"
                  expires_in: 600
                timestamp: "2025-10-17T07:00:00Z"
        '400':
          description: Validasi gagal atau email domain tidak sesuai
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/ValidationErrorResponse'
                  - $ref: '#/components/schemas/ErrorResponse'
              examples:
                validationError:
                  summary: Validation error
                  value:
                    success: false
                    message: "Data validasi tidak valid"
                    code: 400
                    errors:
                      - field: "email"
                        message: "Format email tidak valid"
                      - field: "password"
                        message: "Password minimal 8 karakter"
                    timestamp: "2025-10-17T07:00:00Z"
                domainError:
                  summary: Email domain error
                  value:
                    success: false
                    message: "Hanya email dengan domain polije.ac.id yang dapat digunakan"
                    code: 400
                    errors: null
                    timestamp: "2025-10-17T07:00:00Z"
        '409':
          description: Email sudah terdaftar
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Email sudah terdaftar"
                code: 409
                timestamp: "2025-10-17T07:00:00Z"
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Terjadi kesalahan pada server"
                code: 500
                timestamp: "2025-10-17T07:00:00Z"

  /auth/register/verify-otp:
    post:
      tags:
        - Authentication
      summary: Verifikasi OTP dan selesaikan registrasi
      description: |
        Tahap kedua registrasi: verifikasi OTP yang dikirim ke email
        
        **Flow:**
        1. Frontend tampilkan form input OTP (6 digit)
        2. Frontend kirim email, code (OTP), dan type="register"
        3. Backend validasi OTP, buat user, active akun
        4. Return access token dan set refresh token cookie
        5. Frontend auto login dengan access token
        
        **Keamanan:**
        - OTP berlaku 10 menit
        - Max 5 percobaan, lock setelah itu
        - Refresh token via httpOnly cookie
      operationId: verifyRegisterOTP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyOTPRequest'
            example:
              email: "E41231969@student.polije.ac.id"
              code: "652862"
              type: "register"
      responses:
        '200':
          description: Verifikasi OTP berhasil, akun dibuat dan auto login
          headers:
            Set-Cookie:
              description: Refresh token sebagai httpOnly cookie
              schema:
                type: string
                example: refresh_token=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...; HttpOnly; Secure; SameSite=Strict; Path=/; Max-Age=604800
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthSuccessResponse'
              example:
                success: true
                message: "Verifikasi OTP berhasil, akun dibuat"
                code: 200
                data:
                  user:
                    id: 4
                    name: "Ilman Nafian"
                    email: "E41231969@student.polije.ac.id"
                    is_active: true
                    created_at: "2025-10-17T07:00:00Z"
                    updated_at: "2025-10-17T07:00:00Z"
                  access_token: "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
                  token_type: "Bearer"
                  expires_in: 3600
                timestamp: "2025-10-17T07:00:00Z"
        '400':
          description: Validasi request gagal
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
              example:
                success: false
                message: "Data validasi tidak valid"
                code: 400
                errors:
                  - field: "code"
                    message: "Kode OTP harus 6 digit angka"
                timestamp: "2025-10-17T07:00:00Z"
        '401':
          description: OTP salah atau sesi OTP berakhir
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Kode OTP salah, coba lagi"
                code: 401
                timestamp: "2025-10-17T07:00:00Z"
        '404':
          description: OTP tidak ditemukan atau sudah expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Kode OTP tidak valid atau sudah expired"
                code: 404
                timestamp: "2025-10-17T07:00:00Z"
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Terjadi kesalahan pada server"
                code: 500
                timestamp: "2025-10-17T07:00:00Z"

  /auth/register/resend-otp:
    post:
      tags:
        - Authentication
      summary: Kirim ulang OTP
      description: |
        Kirim ulang OTP ke email dengan rate limit
        
        **Limitasi:**
        - Max 5 kali resend per sesi
        - Cooldown 60 detik antar resend
      operationId: resendRegisterOTP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResendOTPRequest'
            example:
              email: "E41231969@student.polije.ac.id"
              type: "register"
      responses:
        '200':
          description: OTP baru berhasil dikirim
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OTPResponse'
              example:
                success: true
                message: "Kode OTP baru telah dikirim ke email Anda"
                code: 200
                data:
                  message: "Kode OTP baru telah dikirim ke email Anda"
                  expires_in: 600
                timestamp: "2025-10-17T07:00:00Z"
        '404':
          description: Sesi OTP tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Silakan daftar ulang, sesi OTP telah berakhir"
                code: 404
                timestamp: "2025-10-17T07:00:00Z"
        '429':
          description: Terlalu banyak resend, tunggu beberapa saat
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Silakan tunggu beberapa saat sebelum mengirim ulang kode otp"
                code: 429
                timestamp: "2025-10-17T07:00:00Z"
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Terjadi kesalahan pada server"
                code: 500
                timestamp: "2025-10-17T07:00:00Z"

  /auth/login:
    post:
      tags:
        - Authentication
      summary: Login pengguna
      description: |
        Endpoint untuk autentikasi pengguna dengan email dan password.
        
        **Keamanan:**
        - Refresh token dikirim via httpOnly cookie
        - Tidak ada refresh token di response body
        - Access token menggunakan RS256 dengan expired 1 jam
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthRequest'
            example:
              email: "john.doe@example.com"
              password: "password123"
      responses:
        '200':
          description: Login berhasil
          headers:
            Set-Cookie:
              description: Refresh token sebagai httpOnly cookie
              schema:
                type: string
                example: refresh_token=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...; HttpOnly; Secure; SameSite=Strict; Path=/; Max-Age=604800
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthSuccessResponse'
              example:
                success: true
                message: "Login berhasil"
                code: 200
                data:
                  user:
                    id: 1
                    name: "John Doe"
                    email: "john.doe@example.com"
                    is_active: true
                    created_at: "2024-01-01T00:00:00Z"
                    updated_at: "2024-01-01T00:00:00Z"
                  access_token: "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
                  token_type: "Bearer"
                  expires_in: 3600
                timestamp: "2024-01-01T00:00:00Z"
        '400':
          description: Data validasi tidak valid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
        '401':
          description: Email atau password salah
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Email atau password salah"
                code: 401
                timestamp: "2024-01-01T00:00:00Z"
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      description: |
        Endpoint untuk memperbarui access token menggunakan refresh token.
        
        **Keamanan:**
        - Refresh token dibaca dari httpOnly cookie (bukan request body)
        - Token rotation: refresh token lama di-revoke, token baru di-generate
        - New refresh token dikirim via httpOnly cookie yang baru
        - Tidak ada token di response body
      operationId: refreshToken
      parameters:
        - name: Cookie
          in: header
          description: Refresh token cookie
          required: true
          schema:
            type: string
            example: refresh_token=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
      responses:
        '200':
          description: Refresh token berhasil
          headers:
            Set-Cookie:
              description: New refresh token sebagai httpOnly cookie
              schema:
                type: string
                example: refresh_token=newTokenValue; HttpOnly; Secure; SameSite=Strict; Path=/; Max-Age=604800
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshTokenSuccessResponse'
              example:
                success: true
                message: "Token berhasil diperbarui"
                code: 200
                data:
                  access_token: "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
                  token_type: "Bearer"
                  expires_in: 3600
                timestamp: "2024-01-01T00:00:00Z"
        '400':
          description: Refresh token tidak ditemukan di cookie
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Refresh token diperlukan"
                code: 400
                timestamp: "2024-01-01T00:00:00Z"
        '401':
          description: Refresh token tidak valid atau expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Refresh token tidak valid atau sudah expired"
                code: 401
                timestamp: "2024-01-01T00:00:00Z"
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/reset-password:
    post:
      tags:
        - Authentication
      summary: Request reset password
      description: Endpoint untuk meminta reset password, akan mengirim link reset ke email
      operationId: resetPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPasswordRequest'
            example:
              email: "john.doe@example.com"
      responses:
        '200':
          description: Link reset password berhasil dikirim
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                success: true
                message: "Link reset password telah dikirim ke email Anda"
                code: 200
                timestamp: "2024-01-01T00:00:00Z"
        '400':
          description: Data validasi tidak valid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
        '404':
          description: Email tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Email tidak ditemukan"
                code: 404
                timestamp: "2024-01-01T00:00:00Z"
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/reset-password/confirm:
    post:
      tags:
        - Authentication
      summary: Confirm reset password
      description: Endpoint untuk mengkonfirmasi reset password dengan token
      operationId: confirmResetPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewPasswordRequest'
            example:
              token: "abc123def456"
              new_password: "newpassword123"
      responses:
        '200':
          description: Password berhasil direset
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                success: true
                message: "Password berhasil direset"
                code: 200
                timestamp: "2024-01-01T00:00:00Z"
        '400':
          description: Data validasi tidak valid atau token expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
        '404':
          description: Token tidak valid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Token reset password tidak valid"
                code: 404
                timestamp: "2024-01-01T00:00:00Z"
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/logout:
    post:
      tags:
        - Authentication
      summary: Logout pengguna
      description: |
        Endpoint untuk logout pengguna dan invalidate refresh token.
        
        **Keamanan:**
        - Refresh token dibaca dari httpOnly cookie
        - Token di-revoke dari database
        - Cookie di-clear (Max-Age=-1)
      operationId: logout
      security:
        - BearerAuth: []
      parameters:
        - name: Cookie
          in: header
          description: Refresh token cookie yang akan di-invalidate
          required: true
          schema:
            type: string
            example: refresh_token=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
      responses:
        '200':
          description: Logout berhasil
          headers:
            Set-Cookie:
              description: Clear refresh token cookie
              schema:
                type: string
                example: refresh_token=; HttpOnly; Secure; SameSite=Strict; Path=/; Max-Age=-1
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                success: true
                message: "Logout berhasil"
                code: 200
                data: null
                timestamp: "2024-01-01T00:00:00Z"
        '400':
          description: Refresh token diperlukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Refresh token diperlukan"
                code: 400
                errors: null
                timestamp: "2024-01-01T00:00:00Z"
        '401':
          description: Token tidak valid atau sudah expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Tidak memiliki akses"
                code: 401
                errors: null
                timestamp: "2024-01-01T00:00:00Z"
        '404':
          description: Refresh token tidak valid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Refresh token tidak valid"
                code: 404
                errors: null
                timestamp: "2024-01-01T00:00:00Z"
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/reset-password/otp:
    post:
      tags:
        - Authentication OTP
      summary: Mulai reset password dengan OTP
      description: |
        Endpoint untuk memulai proses reset password dengan OTP verification.
        OTP 6-digit akan dikirim ke email yang terdaftar di akun.
      operationId: initiateResetPasswordOTP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: OTP reset password berhasil dikirim
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: Email tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/reset-password/verify-otp:
    post:
      tags:
        - Authentication OTP
      summary: Verifikasi OTP reset password
      description: |
        Endpoint untuk memverifikasi kode OTP reset password.
        Belum mengubah password, hanya verifikasi OTP.
      operationId: verifyResetPasswordOTP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyOTPRequest'
      responses:
        '200':
          description: Verifikasi OTP berhasil
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Validasi gagal
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Kode OTP salah atau sudah expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Email tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/reset-password/confirm-otp:
    post:
      tags:
        - Authentication OTP
      summary: Konfirmasi reset password dengan OTP
      description: |
        Endpoint untuk mengubah password setelah verifikasi OTP.
        Pengguna akan langsung login dengan password baru setelah berhasil.
      operationId: confirmResetPasswordOTP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - code
                - new_password
              properties:
                email:
                  type: string
                  format: email
                code:
                  type: string
                  minLength: 6
                  maxLength: 6
                  description: 6-digit OTP code
                new_password:
                  type: string
                  format: password
                  minLength: 8
      responses:
        '200':
          description: Password berhasil direset
          headers:
            Set-Cookie:
              description: Refresh token sebagai httpOnly cookie
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthSuccessResponse'
        '400':
          description: Validasi gagal
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Email tidak ditemukan atau verifikasi OTP gagal
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/reset-password/resend-otp:
    post:
      tags:
        - Authentication OTP
      summary: Kirim ulang OTP reset password
      description: |
        Endpoint untuk mengirim ulang OTP reset password.
        Rate limited: maksimal 5 kali, cooldown 60 detik antar pengiriman.
      operationId: resendResetPasswordOTP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - type
              properties:
                email:
                  type: string
                  format: email
                type:
                  type: string
                  enum: [reset_password]
      responses:
        '200':
          description: OTP resend berhasil
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: Sesi OTP expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Terlalu banyak percobaan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Kesalahan server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        RS256 JWT token. Algoritma: RSA 2048-bit.
        Expired: 1 jam.
        Format: Bearer {access_token}

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        name:
          type: string
          example: "John Doe"
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        is_active:
          type: boolean
          example: true
        created_at:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00Z"

    AuthRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        password:
          type: string
          format: password
          minLength: 8
          example: "password123"

    RegisterRequest:
      type: object
      required:
        - name
        - email
        - password
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 100
          example: "John Doe"
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        password:
          type: string
          format: password
          minLength: 8
          example: "password123"

    ResetPasswordRequest:
      type: object
      required:
        - email
      properties:
        email:
          type: string
          format: email
          example: "john.doe@example.com"

    NewPasswordRequest:
      type: object
      required:
        - token
        - new_password
      properties:
        token:
          type: string
          example: "abc123def456"
        new_password:
          type: string
          format: password
          minLength: 8
          example: "newpassword123"

    VerifyOTPRequest:
      type: object
      required:
        - email
        - code
        - type
      properties:
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        code:
          type: string
          minLength: 6
          maxLength: 6
          pattern: '^\d{6}$'
          description: 6-digit OTP code
          example: "123456"
        type:
          type: string
          enum: [register, reset_password]
          example: "register"

    AuthResponse:
      type: object
      description: Response tidak mengandung refresh_token di body. Refresh token dikirim via httpOnly cookie.
      properties:
        user:
          $ref: '#/components/schemas/User'
        access_token:
          type: string
          description: RS256 JWT token dengan expired 1 jam
          example: "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
        token_type:
          type: string
          example: "Bearer"
        expires_in:
          type: integer
          description: Access token expiration dalam detik (3600 = 1 jam)
          example: 3600

    RefreshTokenResponse:
      type: object
      description: Response tidak mengandung refresh_token di body. New refresh token dikirim via httpOnly cookie.
      properties:
        access_token:
          type: string
          description: RS256 JWT token dengan expired 1 jam
          example: "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
        token_type:
          type: string
          example: "Bearer"
        expires_in:
          type: integer
          description: Access token expiration dalam detik (3600 = 1 jam)
          example: 3600

    BaseResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        code:
          type: integer
        timestamp:
          type: string
          format: date-time

    SuccessResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              nullable: true

    ErrorResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse' 
        - type: object
          properties:
            errors:
              type: object
              nullable: true

    AuthSuccessResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/AuthResponse'

    RefreshTokenSuccessResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/RefreshTokenResponse'

    ValidationError:
      type: object
      properties:
        field:
          type: string
          example: "email"
        message:
          type: string
          example: "Format email tidak valid"

    OTPResponse:
      type: object
      properties:
        message:
          type: string
          example: "Kode OTP telah dikirim ke email Anda"
        expires_in:
          type: integer
          description: OTP expiration dalam detik
          example: 600

    ResendOTPRequest:
      type: object
      required:
        - email
        - type
      properties:
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        type:
          type: string
          enum: [register, reset_password]
          example: "register"

    ValidationErrorResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            errors:
              type: array
              items:
                $ref: '#/components/schemas/ValidationError'

tags:
  - name: Authentication
    description: |
      Endpoint untuk sistem autentikasi pengguna dengan enhanced security:
      - RS256 (RSA 2048-bit) signing algorithm
      - Cookie-based refresh token (httpOnly, secure, sameSite=Strict)
      - Token rotation pada setiap refresh
      - Hash storage untuk refresh token di database (SHA-256)
      - Key rotation capability
      - CORS dengan domain eksplisit
