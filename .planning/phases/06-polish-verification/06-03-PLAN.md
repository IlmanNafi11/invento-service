---
phase: 06-polish-verification
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/controller/http/tus_controller.go
  - internal/controller/http/tus_modul_controller.go
  - internal/controller/http/user_controller.go
autonomous: true

must_haves:
  truths:
    - "All TUS endpoints have Swagger annotations with correct TUS-specific response formats"
    - "GetUsersForRole and BulkAssignRole have Swagger annotations"
    - "TUS endpoints use @Success 204 (not 200) for chunk/cancel/reset operations"
    - "TUS endpoints include @Header annotations for TUS protocol headers"
  artifacts:
    - path: "internal/controller/http/tus_controller.go"
      provides: "Swagger annotations for all TUS project upload endpoints"
      contains: "@Router"
    - path: "internal/controller/http/tus_modul_controller.go"
      provides: "Swagger annotations for all TUS modul upload endpoints"
      contains: "@Router"
    - path: "internal/controller/http/user_controller.go"
      provides: "Swagger annotations for GetUsersForRole and BulkAssignRole"
      contains: "GetUsersForRole"
  key_links:
    - from: "internal/controller/http/tus_controller.go"
      to: "docs/swagger.json"
      via: "swag init annotation parsing"
      pattern: "@Router"
---

<objective>
Add missing Swagger annotations to all 20+ undocumented endpoints (TUS project uploads, TUS modul uploads, GetUsersForRole, BulkAssignRole).

Purpose: Complete Swagger documentation coverage so that `swag init` generates a comprehensive API spec covering every endpoint.
Output: All controller functions have Swagger annotations.
</objective>

<execution_context>
@/home/ilmannafi/.claude/get-shit-done/workflows/execute-plan.md
@/home/ilmannafi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-polish-verification/06-RESEARCH.md
@internal/controller/http/tus_controller.go
@internal/controller/http/tus_modul_controller.go
@internal/controller/http/user_controller.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Swagger annotations to TUS project and modul upload controllers</name>
  <files>
    internal/controller/http/tus_controller.go
    internal/controller/http/tus_modul_controller.go
  </files>
  <action>
  Add Swagger annotations to ALL handler functions in both TUS controllers. These endpoints use TUS protocol conventions (204 No Content, headers-only responses for many operations).

  **TUS Controller (tus_controller.go)** -- add annotations to these methods:
  - `CheckUploadSlot`: POST, checks if upload slot is available. Returns 200 JSON or 409 conflict.
  - `InitiateUpload`: POST, creates new TUS upload. Returns 201 with Location header.
  - `UploadChunk`: PATCH, uploads file chunk. Returns 204 with Upload-Offset header.
  - `GetUploadStatus`: GET, returns upload progress. Returns 200 JSON.
  - `GetUploadInfo`: HEAD, returns upload metadata via headers. Returns 200 with TUS headers.
  - `CancelUpload`: DELETE, cancels and cleans up upload. Returns 204.
  - `ResetUploadQueue`: POST, resets the upload queue. Returns 200.
  - `InitiateProjectUpdateUpload`: POST, starts project update upload. Returns 201 with Location.
  - `UploadProjectUpdateChunk`: PATCH, uploads project update chunk. Returns 204 with Upload-Offset.
  - `GetProjectUpdateUploadStatus`: GET, returns update upload progress. Returns 200 JSON.
  - `GetProjectUpdateUploadInfo`: HEAD, returns update upload metadata. Returns 200 with TUS headers.
  - `CancelProjectUpdateUpload`: DELETE, cancels update upload. Returns 204.

  **TUS Modul Controller (tus_modul_controller.go)** -- add annotations to these methods:
  - `CheckUploadSlot`: POST, checks modul upload slot. Returns 200 JSON or 409.
  - `InitiateUpload`: POST, creates new modul TUS upload. Returns 201 with Location.
  - `UploadChunk`: PATCH, uploads modul file chunk. Returns 204 with Upload-Offset.
  - `GetModulUpdateUploadStatus`: GET, returns modul upload progress. Returns 200 JSON.
  - `GetModulUpdateUploadInfo`: HEAD, returns modul upload metadata. Returns 200 with TUS headers.
  - `CancelModulUpdateUpload`: DELETE, cancels modul upload. Returns 204.
  - `InitiateModulUpdateUpload`: POST, starts modul update upload. Returns 201 with Location.
  - `UploadModulUpdateChunk`: PATCH, uploads modul update chunk. Returns 204 with Upload-Offset.

  **Annotation patterns for TUS endpoints (from research):**

  For PATCH (chunk upload) endpoints:
  ```go
  // @Accept       application/offset+octet-stream
  // @Success      204 "Chunk uploaded successfully"
  // @Header       204 {string} Upload-Offset "Updated upload offset"
  // @Header       204 {string} Tus-Resumable "TUS protocol version"
  ```

  For POST (initiate) endpoints:
  ```go
  // @Accept       json
  // @Produce      json
  // @Success      201 {object} dto.SuccessResponse "Upload initiated"
  // @Header       201 {string} Location "Upload URL"
  // @Header       201 {string} Tus-Resumable "TUS protocol version"
  ```

  For DELETE (cancel) endpoints:
  ```go
  // @Success      204 "Upload cancelled"
  ```

  For HEAD (info) endpoints:
  ```go
  // @Success      200 "Upload info"
  // @Header       200 {string} Upload-Offset "Current offset"
  // @Header       200 {string} Upload-Length "Total file size"
  // @Header       200 {string} Tus-Resumable "TUS protocol version"
  ```

  All TUS endpoints should use:
  - `@Tags TUS Upload` for project uploads, `@Tags TUS Modul Upload` for modul uploads
  - `@Security BearerAuth` (all require authentication)
  - `@Param Tus-Resumable header string true "TUS protocol version" default(1.0.0)` where applicable
  - Correct `@Router` paths matching routes.go registration

  Read `internal/app/routes.go` to verify the exact route paths for each handler.
  Read existing annotated controllers (e.g., project_controller.go, modul_controller.go) for consistent annotation style.
  </action>
  <verify>Run `go build ./...` to confirm annotations don't break compilation. Run `grep -c "@Router" internal/controller/http/tus_controller.go internal/controller/http/tus_modul_controller.go` to count annotated endpoints (should be 12 + 8 = 20).</verify>
  <done>All TUS project upload endpoints (12) and TUS modul upload endpoints (8) have complete Swagger annotations with correct TUS protocol response formats, headers, and security tags.</done>
</task>

<task type="auto">
  <name>Task 2: Add Swagger annotations to GetUsersForRole and BulkAssignRole</name>
  <files>internal/controller/http/user_controller.go</files>
  <action>
  Add Swagger annotations to the two missing user management endpoints:

  1. **GetUsersForRole** -- read the method signature and implementation to determine:
     - HTTP method and route path (check routes.go)
     - Request parameters (likely role_id as path param or query param)
     - Response format (likely dto.SuccessResponse with user list)
     - Add appropriate annotations following existing user controller annotation style

  2. **BulkAssignRole** -- read the method signature and implementation to determine:
     - HTTP method and route path (check routes.go)
     - Request body format (likely a DTO with user IDs and role ID)
     - Response format
     - Add appropriate annotations

  Follow the exact style used by other methods in user_controller.go (e.g., GetUserList, UpdateProfile).
  Use `@Tags User Management` to match existing user endpoint tags.
  Use `@Security BearerAuth` for both endpoints.
  </action>
  <verify>Run `go build ./...` to confirm no compilation errors. Run `grep -c "@Router" internal/controller/http/user_controller.go` and compare with the total number of handler methods to confirm complete coverage.</verify>
  <done>GetUsersForRole and BulkAssignRole have complete Swagger annotations matching the existing user controller style. All user controller methods have @Router annotations.</done>
</task>

</tasks>

<verification>
1. `go build ./...` passes
2. All TUS controller methods have @Router annotations (20 endpoints)
3. GetUsersForRole and BulkAssignRole have @Router annotations
4. TUS chunk endpoints use @Success 204, not 200
5. TUS endpoints include @Header annotations for protocol headers
</verification>

<success_criteria>
- 22+ previously undocumented endpoints now have complete Swagger annotations
- TUS endpoints correctly annotate non-JSON responses (204 No Content, headers)
- All annotations use consistent Tags and Security settings
- go build passes
</success_criteria>

<output>
After completion, create `.planning/phases/06-polish-verification/06-03-SUMMARY.md`
</output>
