---
phase: 06-polish-verification
plan: 04
type: execute
wave: 2
depends_on: ["06-01", "06-02"]
files_modified:
  - "Various files across internal/, config/, cmd/ (determined by lint output)"
autonomous: true

must_haves:
  truths:
    - "golangci-lint run exits with zero warnings and zero errors"
    - "All Go files are gofumpt-formatted"
    - "Zero unused functions, variables, or types remain"
    - "Zero unchecked errors remain (errcheck clean)"
  artifacts:
    - path: ".golangci.yml"
      provides: "Comprehensive linter configuration"
      contains: "goconst"
  key_links:
    - from: ".golangci.yml"
      to: "golangci-lint run output"
      via: "linter execution"
      pattern: "max-issues-per-linter: 0"
---

<objective>
Run the comprehensive golangci-lint suite with zero-warning policy and fix ALL reported issues. Then run gofumpt across the entire codebase for final formatting consistency.

Purpose: Achieve the zero-warning quality gate required by Phase 6 success criteria. This is the core quality pass.
Output: Clean lint output, consistently formatted codebase.
</objective>

<execution_context>
@/home/ilmannafi/.claude/get-shit-done/workflows/execute-plan.md
@/home/ilmannafi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-polish-verification/06-RESEARCH.md
@.planning/phases/06-polish-verification/06-01-SUMMARY.md
@.planning/phases/06-polish-verification/06-02-SUMMARY.md
@.golangci.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run golangci-lint and fix all warnings iteratively</name>
  <files>Various files across internal/, config/, cmd/ (determined by lint output)</files>
  <action>
  Run `golangci-lint run ./...` with the config fixed in Plan 01. Fix ALL warnings iteratively until the output is clean.

  **Iterative approach:**
  1. Run `golangci-lint run ./... 2>&1 | head -100` to see first batch of warnings
  2. Group warnings by linter type and fix in order of impact:
     a. **unused** -- delete unused functions, types, variables, constants. These are safe to remove since the linter verified they have no callers.
     b. **errcheck** -- add error handling for unchecked error returns. Use `_ =` only for truly ignorable errors (e.g., `defer f.Close()`) with a comment explaining why.
     c. **govet** -- fix struct alignment, printf format issues, etc.
     d. **staticcheck** -- fix deprecated API usage, simplifiable code, etc.
     e. **ineffassign** -- remove or use ineffectually assigned variables.
     f. **gocritic** -- fix diagnostic and style issues (e.g., `if err != nil { return err }; return nil` -> `return err`).
     g. **revive** -- fix exported type documentation, naming issues.
     h. **errorlint** -- fix error wrapping (use `%w` not `%v` for errors, use `errors.Is`/`errors.As`).
     i. **unparam** -- remove or use unused function parameters. If a parameter is required by an interface, mark with `_ =` comment.
     j. **unconvert** -- remove unnecessary type conversions.
     k. **nilerr** -- fix nil error returns after error checks.
     l. **goconst** -- extract repeated string literals into constants (beyond what Plan 01 already did).
     m. **godox** -- any remaining TODO/FIXME/HACK (should be gone from Plan 01, but catch stragglers).
     n. **misspell** -- fix typos in comments and strings.
  3. After each batch of fixes, run `go build ./...` and `go test ./... -count=1 2>&1 | grep FAIL` to ensure no regressions.
  4. Repeat until `golangci-lint run ./... 2>&1 | wc -l` shows only the header line (no warnings).

  **Important guidelines:**
  - Per user decision: "Trust the linter -- delete any function/type/variable that golangci-lint reports as unused"
  - For errcheck on deferred Close() calls: use `defer func() { _ = f.Close() }()` pattern
  - For interface-required parameters that are unused: the linter should not flag these, but if it does, use `_ = param` with comment
  - Do NOT suppress warnings with `//nolint` comments unless there is a genuine false positive with clear justification
  - If goconst reports repeated strings, create constants in the appropriate package's constants file
  - Run `go build ./...` after every batch to catch breakage early
  - Verify test skip count matches what Plan 02 established (tests should not regress)
  </action>
  <verify>Run `golangci-lint run ./... 2>&1` -- must show zero warnings and exit 0. Run `go build ./...` -- must pass. Run `go test ./... -count=1 2>&1 | grep FAIL` -- must show zero failures (or same skip count as Plan 02 established).</verify>
  <done>golangci-lint run exits with zero warnings across the entire codebase. go build passes. No test regressions.</done>
</task>

<task type="auto">
  <name>Task 2: Run gofumpt across entire codebase for formatting consistency</name>
  <files>All .go files in the project</files>
  <action>
  Run `gofumpt -w .` from the project root to format ALL Go files with gofumpt's stricter formatting rules.

  gofumpt enforces stricter rules than gofmt:
  - No empty lines at start/end of function bodies
  - No empty lines around single-statement blocks
  - Consistent import grouping
  - Octal literals use 0o prefix

  After running gofumpt:
  1. Run `go build ./...` to verify no breakage
  2. Run `go test ./... -count=1 2>&1 | grep FAIL` to verify no test regressions
  3. Run `golangci-lint run ./...` one final time to confirm the formatting pass didn't introduce any new lint issues (it shouldn't, since gofumpt is also configured as a formatter in golangci-lint)

  This should be a single command with verification -- gofumpt is deterministic and safe.
  </action>
  <verify>Run `gofumpt -d . 2>&1 | wc -l` -- must show 0 (no formatting differences remaining). Run `golangci-lint run ./...` -- must still show zero warnings. Run `go build ./...` -- must pass.</verify>
  <done>All Go files in the project are gofumpt-formatted. Zero formatting differences. golangci-lint still clean. go build passes.</done>
</task>

</tasks>

<verification>
1. `golangci-lint run ./...` exits 0 with zero warnings
2. `gofumpt -d .` shows no differences
3. `go build ./...` passes
4. `go test ./... -count=1 2>&1 | grep FAIL` shows zero failures
</verification>

<success_criteria>
- Zero golangci-lint warnings across the entire codebase
- All Go files consistently formatted with gofumpt
- No test regressions
- No `//nolint` suppressions without clear justification
</success_criteria>

<output>
After completion, create `.planning/phases/06-polish-verification/06-04-SUMMARY.md`
</output>
