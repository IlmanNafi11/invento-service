---
phase: 06-polish-verification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .golangci.yml
  - internal/middleware/constants.go
  - config/constants.go
  - internal/middleware/auth.go
  - internal/middleware/rbac_middleware.go
  - internal/controller/base/controller.go
  - internal/controller/http/tus_helpers.go
  - internal/controller/http/auth_controller.go
  - config/database.go
  - internal/usecase/auth_usecase.go
  - internal/storage/file_manager.go
  - internal/storage/modul_helper.go
  - internal/storage/project_helper.go
  - internal/storage/path_resolver.go
  - internal/httputil/cookie_helper.go
autonomous: true

must_haves:
  truths:
    - "golangci-lint config validates without errors (golangci-lint config verify passes)"
    - "goconst and godox linters are enabled and detecting magic strings and TODO comments"
    - "Context locals keys use typed constants from middleware package"
    - "Environment name comparisons use typed constants from config package"
    - "Zero TODO/FIXME/HACK comments remain in production code"
    - "Zero commented-out code blocks remain in production code"
  artifacts:
    - path: ".golangci.yml"
      provides: "Valid golangci-lint v2 config with comprehensive linter set"
      contains: "goconst"
    - path: "internal/middleware/constants.go"
      provides: "Context locals key constants"
      contains: "LocalsKeyUserID"
    - path: "config/constants.go"
      provides: "Environment name constants"
      contains: "EnvDevelopment"
  key_links:
    - from: "internal/middleware/auth.go"
      to: "internal/middleware/constants.go"
      via: "LocalsKeyUserID, LocalsKeyUserEmail, etc."
      pattern: "LocalsKey"
    - from: "config/database.go"
      to: "config/constants.go"
      via: "EnvDevelopment, EnvProduction"
      pattern: "Env(Development|Production)"
---

<objective>
Fix the broken golangci-lint v2 config, extract remaining magic strings into typed constants, and remove all dead code artifacts (commented-out blocks, TODO/FIXME/HACK comments).

Purpose: Establish the foundation for the comprehensive lint pass (Plan 04) and satisfy CLN-01 and CFG-01 requirements.
Output: Working lint config, magic string constants, cleaned source files.
</objective>

<execution_context>
@/home/ilmannafi/.claude/get-shit-done/workflows/execute-plan.md
@/home/ilmannafi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-polish-verification/06-RESEARCH.md
@.golangci.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix golangci-lint v2 config and add goconst/godox linters</name>
  <files>.golangci.yml</files>
  <action>
  Replace the current .golangci.yml with a corrected v2 config. The current config has two issues:

  1. `output.formats` uses v1 map syntax (`colored-line-number: {}`) instead of v2 list syntax (`- format: colored-line-number`)
  2. `gosimple` is listed but was removed in v2 (folded into `staticcheck`)
  3. Missing `goconst` (detects magic string repetition) and `godox` (detects TODO/FIXME/HACK) linters
  4. `max-issues-per-linter: 50` and `max-same-issues: 5` hide warnings (must be 0 for zero-warning policy)

  Use this exact config (from research, verified against golangci-lint v2.0.1):

  ```yaml
  version: "2"

  linters:
    enable:
      - govet
      - errcheck
      - staticcheck
      - unused
      - ineffassign
      - gocritic
      - revive
      - misspell
      - unparam
      - unconvert
      - nilerr
      - errorlint
      - goconst
      - godox
    settings:
      govet:
        enable-all: true
      errcheck:
        check-type-assertions: true
      revive:
        rules:
          - name: exported
            arguments:
              - "checkPrivateReceivers"
      gocritic:
        enabled-tags:
          - diagnostic
          - style
      godox:
        keywords:
          - TODO
          - FIXME
          - HACK
          - XXX
      goconst:
        min-len: 3
        min-occurrences: 3

  formatters:
    enable:
      - gofumpt
    settings:
      gofumpt:
        extra-rules: true

  run:
    timeout: 5m

  output:
    formats:
      - format: colored-line-number

  issues:
    max-issues-per-linter: 0
    max-same-issues: 0
  ```

  Do NOT include `deadcode`, `gosimple`, or `typecheck` -- these are removed in v2 (covered by `unused`, `staticcheck`, and built-in respectively).
  Do NOT put `gofumpt` under `linters.enable` -- it goes under `formatters.enable` in v2.
  </action>
  <verify>Run `golangci-lint config verify` from the project root -- must exit 0 with no validation errors. Then run `golangci-lint help linters | grep -E "(goconst|godox)"` to confirm both are recognized.</verify>
  <done>golangci-lint config validates successfully, all specified linters are recognized, output.formats uses correct v2 schema, max-issues set to 0.</done>
</task>

<task type="auto">
  <name>Task 2: Extract magic string constants for context keys and environment names</name>
  <files>
    internal/middleware/constants.go
    config/constants.go
    internal/middleware/auth.go
    internal/middleware/rbac_middleware.go
    internal/controller/base/controller.go
    internal/controller/http/tus_helpers.go
    internal/controller/http/auth_controller.go
    config/database.go
    internal/usecase/auth_usecase.go
    internal/storage/file_manager.go
    internal/storage/modul_helper.go
    internal/storage/project_helper.go
    internal/storage/path_resolver.go
    internal/httputil/cookie_helper.go
  </files>
  <action>
  Create two new constant files and replace all magic string usages:

  1. Create `internal/middleware/constants.go`:
  ```go
  package middleware

  // Context locals keys used by auth middleware and consumed by controllers.
  const (
      LocalsKeyUserID      = "user_id"
      LocalsKeyUserEmail   = "user_email"
      LocalsKeyUserRole    = "user_role"
      LocalsKeyAccessToken = "access_token"
      LocalsKeyRequest     = "request"
  )
  ```

  2. Create `config/constants.go`:
  ```go
  package config

  // Environment names for App.Env comparisons.
  const (
      EnvDevelopment = "development"
      EnvProduction  = "production"
  )
  ```

  3. Replace all string literal usages across the codebase:

  **Context locals keys** -- grep for `"user_id"`, `"user_email"`, `"user_role"`, `"access_token"`, `"request"` used with `c.Locals()` or `c.Locals().(type)`:
  - In middleware files: replace with `LocalsKeyUserID` etc. (same package, no import needed)
  - In controller files: import `middleware` package and use `middleware.LocalsKeyUserID` etc.
  - In tus_helpers.go: same controller import pattern

  **Environment names** -- grep for `"development"` and `"production"` used in comparisons:
  - In config package files: replace with `EnvDevelopment`/`EnvProduction` (same package, no import needed)
  - In other packages (storage, httputil, usecase): import `config` package and use `config.EnvDevelopment`/`config.EnvProduction`

  IMPORTANT: Be careful about circular imports. If any file in storage/usecase/httputil already imports config, using `config.EnvDevelopment` is safe. If importing config would create a circular dependency, define a local constant instead and add a comment noting why.

  Do NOT modify test files for these replacements -- test files can keep string literals for test fixture data.
  </action>
  <verify>Run `go build ./...` to confirm no compilation errors or circular imports. Run `grep -rn '"user_id"\|"user_email"\|"user_role"\|"access_token"' internal/ --include="*.go" | grep -v _test.go | grep -v constants.go` to confirm zero remaining magic string usages in production code (excluding constants definition files and test files). Run `grep -rn '"development"\|"production"' internal/ config/ --include="*.go" | grep -v _test.go | grep -v constants.go | grep -v .env` to confirm zero remaining environment string literals.</verify>
  <done>All context locals keys use middleware.LocalsKey* constants. All environment name comparisons use config.Env* constants. Zero magic string occurrences in production code. go build passes with no circular imports.</done>
</task>

<task type="auto">
  <name>Task 3: Remove all commented-out code blocks and TODO/FIXME/HACK comments</name>
  <files>All .go files in the project (production code only, not test files unless they contain commented-out code)</files>
  <action>
  Perform a systematic cleanup pass across the entire codebase:

  1. **Remove commented-out code blocks:** Search for blocks of commented-out Go syntax (function calls, variable declarations, control flow, import statements). Remove these entirely.
     - Pattern to find: `grep -rn "^[[:space:]]*//[[:space:]]*[a-z].*(" --include="*.go"` (commented function calls)
     - Pattern to find: `grep -rn "^[[:space:]]*//[[:space:]]*\(if\|for\|var\|return\|err\|func\)" --include="*.go"` (commented control flow)
     - PRESERVE: godoc comments (`// Package`, `// FuncName`), descriptive comments explaining WHY, license headers, build tags
     - Per research pitfall #7: only remove blocks containing actual Go syntax, not explanatory comments

  2. **Remove TODO/FIXME/HACK/XXX comments:** Search for all instances and remove them.
     - `grep -rn "TODO\|FIXME\|HACK\|XXX" --include="*.go"` to find all instances
     - Remove the entire comment line containing these keywords
     - If the TODO describes future work that matters, the user has decided to track it in the roadmap, not in code

  3. **Remove unused imports** that may result from code block removal (go build will catch these).

  Do NOT remove:
  - Test fixture comments (comments in test files that explain test setup)
  - Swagger annotation comments (`// @Summary`, `// @Description`, etc.)
  - godoc comments for exported functions/types
  - Build constraint comments (`//go:build`, `//go:generate`)
  - Comments explaining non-obvious behavior (e.g., "// Background context because request context may be cancelled")
  </action>
  <verify>Run `grep -rn "TODO\|FIXME\|HACK\|XXX" --include="*.go" internal/ cmd/ config/` to confirm zero remaining instances. Run `go build ./...` to confirm no broken imports or syntax. Run `go test ./... -count=1 2>&1 | tail -5` to confirm tests still pass (or at least no new failures introduced).</verify>
  <done>Zero TODO/FIXME/HACK/XXX comments in production code. Zero commented-out code blocks. go build passes. No new test failures introduced.</done>
</task>

</tasks>

<verification>
1. `golangci-lint config verify` exits 0
2. `go build ./...` passes
3. `grep -rn "TODO\|FIXME\|HACK\|XXX" --include="*.go" internal/ cmd/ config/` returns empty
4. `grep -rn '"user_id"\|"user_email"\|"user_role"' internal/ --include="*.go" | grep -v _test.go | grep -v constants.go` returns empty
5. `grep -rn '"development"\|"production"' internal/ config/ --include="*.go" | grep -v _test.go | grep -v constants.go` returns empty
</verification>

<success_criteria>
- golangci-lint v2 config is valid and includes goconst + godox linters
- All context locals keys use typed constants
- All environment name comparisons use typed constants
- Zero TODO/FIXME/HACK/XXX comments remain in production code
- Zero commented-out code blocks remain
- go build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-polish-verification/06-01-SUMMARY.md`
</output>
