version: '3.8'

services:
  invento-backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: invento-api
    restart: unless-stopped
    ports:
      - "${APP_PORT:-8080}:8080"
    environment:
      APP_ENV: ${APP_ENV:-development}
      APP_PORT: ${APP_PORT:-8080}
      SUPABASE_URL: ${SUPABASE_URL}
      SUPABASE_SERVICE_ROLE_KEY: ${SUPABASE_SERVICE_ROLE_KEY}
      SUPABASE_ANON_KEY: ${SUPABASE_ANON_KEY}
      SUPABASE_DB_URL: ${SUPABASE_DB_URL}
      DB_AUTO_MIGRATE: ${DB_AUTO_MIGRATE:-true}
      DB_MIGRATE_ON_START: ${DB_MIGRATE_ON_START:-true}
      JWT_SECRET: ${JWT_SECRET:-your-secret-key}
      MAILTRAP_API_TOKEN: ${MAILTRAP_API_TOKEN}
      MAILTRAP_SENDER_EMAIL: ${MAILTRAP_SENDER_EMAIL}
    volumes:
      - ./uploads:/app/uploads
      - ./keys:/app/keys
    networks:
      - invento-network
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/api/v1/health"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 10s

networks:
  invento-network:
    driver: bridge
